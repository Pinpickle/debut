/*! oliver-and-swan 2014-02-20 */
!function(exports,global){function Animation(a){this.fun=a,this.start="onstep",this.delay=0,this._elem=null,this.depth=1,this.domClone=null,this.notes=null,this.run=function(a,b,c,d){if(!b&&!this.domClone){this.domClone=$(this._elem).clone();var e=($(this._elem).css("transit:transform")||"").toString();$(this.domClone).css("transit:transform",new $.transit.Transform(e)),this.params.domClone=this.domClone}var f={};b&&(f.direction=-this.params.direction),this.fun(this._elem,a,$.extend({},this.params,c||{},f),d||function(){})}}function toCamelCase(a,b){return"undefined"==typeof b&&(b="-"),a.split(b).map(function(a,b){return 0===b?a.charAt(0).toLowerCase()+a.slice(1):a.charAt(0).toUpperCase()+a.slice(1)}).join("")}global["true"]=exports;var $=jQuery,animations={appear:function(a,b,c,d){1===c.direction?$(a).css("opacity",""):-1===c.direction&&$(a).css("opacity",0),d()},slide:function(a,b,c,d){var e=0,f=0;c=$.extend({side:"left"},c),1===c.direction&&c.domClone&&$(a).css({x:$(c.domClone).css("x"),y:$(c.domClone).css("y")}),$(a).css("opacity",1);var g=$(a).offset();switch(g.left=(g.left-b.containerLeft)/b.scale,g.top=(g.top-b.containerTop)/b.scale,c.side){default:case"left":e=-($(a).width()+g.left);break;case"right":e=b.containerWidth-g.left;break;case"top":f=-($(a).height()+g.top);break;case"bottom":f=b.innerContainer.height()-g.top}1===c.direction&&$(a).css({x:"+="+c.direction*e,y:"+="+c.direction*f}),$(a).transit({x:"+="+-c.direction*e,y:"+="+-c.direction*f},c.duration,c.easing,d)},animate:function(a,b,c,d){var e={};if(1===c.direction)e=c.prop;else{var f=$(c.domClone);for(var g in c.prop)e[g]=f.css(g)}$(a).transit(e,c.duration,c.easing,d)},fade:function(a,b,c,d){$(a).transit({opacity:1===c.direction?1:0},c.duration,c.easing,d)}},slideMasterOptions=[{key:"letterbox",type:"boolean","default":!1},{key:"aspect-ratio",type:function(a){var b=a.split(":");return parseFloat(b[0])/parseFloat(b[1])},"default":16/9},{key:"container-height",type:"number","default":500}],presentationObjectOptions=[{key:"anim",type:"animation","default":null},{key:"end-exit-children",type:"boolean","default":!1},{key:"end-exit",type:"animation","default":null},{key:"anim-children-step",type:"animation","default":null}],validTransforms=["x","y","z","rotate","rotate-x","rotate-y","scale","scale-x","scale-y"];for(var i in validTransforms)presentationObjectOptions.push({key:validTransforms[i],type:"string","default":null}),validTransforms[i]=toCamelCase(validTransforms[i]);var OliverAndSwan=function(a,b){this.innerContainer=null,this.outerContainer=null,this.index=0;var c,d,e=this.animationQueue=[],f=$('<div class="presentation-container"></div>'),g=a,h=$(a).getDOMOptions(slideMasterOptions),i=this;$(a).addClass("presentation-master"),b=$.extend({},h,b),this.containerHeight=b.containerHeight,this.containerWidth=this.containerHeight*b.aspectRatio,this.scale=1,f.height(this.containerHeight),f.width(this.containerWidth),f.css("transform-origin","0 0"),this.containerLeft=0,this.containerTop=0,this.depth=f.parents().length,this.resize=function(){var a;(g.width()!=c||g.height()!=d)&&(c=g.width(),d=g.height(),a=c/d,a>b.aspectRatio?(i.scale=d/i.containerHeight,i.containerLeft=(c-i.scale*i.containerWidth)/2,i.containerTop=0):(i.scale=c/i.containerWidth,i.containerLeft=0,i.containerTop=(d-i.scale*i.containerHeight)/2),f.css({left:i.containerLeft,top:i.containerTop}),f.css("scale",i.scale))},$(window).resize(this.resize),this.resize(),$(a).children("*").appendTo(f),f.appendTo(a),this.outerContainer=$(a),this.outerContainer.attr("tabindex",1),this.innerContainer=f,f.find(".floater").each(function(){var a=(i.containerWidth-$(this).width())/2,b=(i.containerHeight-$(this).height())/2,c=$(this).getDOMOptions(presentationObjectOptions);$(this).css({top:b,left:a});for(var d in validTransforms)c[validTransforms[d]]&&$(this).css(validTransforms[d],c[validTransforms[d]])}),b.letterbox&&(console.log(b),$(this.outerContainer).addClass("letterbox"));var j=function(){var a=$(this).getDOMOptions(presentationObjectOptions),b=$(this);if(a.anim&&(b.css("opacity",0),a.anim.params=$.extend({},{direction:1,duration:500,easing:"in-out"},a.anim.params),a.anim.depth=b.parents().length-i.depth,e.push(a.anim)),a.animChildrenStep&&$(this).children().each(function(a,c){(void 0===$(c).attr("data-anim")||$(c).attr("data-anim")===!1)&&$(c).attr("data-anim",b.attr("data-anim-children-step"))}),$(this).children().each(j),a.endExitChildren){$(this).children().each(function(a,b){k(b,!0)})}else a.endExit&&(a.endExit.params=$.extend({},{direction:-1,duration:500,easing:"in-out"},a.endExit.params),a.endExit.depth=b.parents().length-i.depth,e.push(a.endExit))},k=function(a){var b=$(a).getDOMOptions(presentationObjectOptions);a=$(a),b.anim&&!b.exit&&(b.exit=$.extend(!0,new Animation,b.anim)),b.exit&&(b.exit.params=$.extend({},{direction:-1,duration:500,easing:"in-out"},b.exit.params),b.exit._elem=a,b.exit.start=0!==a.index()?"withprevious":"onstep",b.exit.depth=a.parents().length-i.depth,e.push(b.exit))};this.innerContainer.children().each(j),$(this.outerContainer).keydown(function(a){(39===a.which||37===a.which)&&i.proceed(37===a.which)}),$(this.outerContainer).click(function(){i.proceed()}),this.presenterView=null,this.openPresenterView=function(a,b){return i.presenterView=window.open(a,"Presenter"+location.href),$(i.presenterView.document).ready(function(){i.presenterView.ready(i),b&&b(i.presenterView)}),i.presenterView},this.on=function(a,b){$(i).on(a,b)},this.trigger=function(a,b){$(this).trigger(a,b)},this.goTo=function(a){var b=a<i.index;if(a!==i.index){if(0>a||a>=e.length)throw new Error("Index out of animation queue bounds");var c=function(){b&&i.index<=a||!b&&i.index>=a||i.proceed(b,0,c)};c()}},this.proceed=function(a,b,c){var d,f;if(a=!!a){if(i.index<=0)return;i.index-=1}else if(i.index>=e.length)return;d=e[i.index],f=d.constructor.name;var g={};"undefined"!=typeof b&&(g.duration=b),a||(i.index+=1),i.index in e&&"withprevious"===e[i.index].start?(d.run(i,a,g),0===d.delay?i.proceed(a,b,c):setTimeout(function(){i.proceed(a,b,c)},d.delay)):d.run(i,a,g,c||void 0)}};$.fn.getDOMOptions=function(template){var i,attr,type,key,val,options={};for(i in template){if(key=toCamelCase(template[i].key),attr=this.attr("data-"+template[i].key),"undefined"!=typeof attr)switch(type=template[i].type,typeof type){case"string":switch(type){case"boolean":options[key]=!1,(attr||""===attr)&&(options[key]=!0);break;case"number":case"float":val=parseFloat(attr),isNaN(val)?""===attr&&(options[key]=0):options[key]=val;break;case"animation":var anim=attr,parsed=attr?attr.match(/([^{]+){([\s\S]+)/m):null,params={};if(parsed)params=eval("({"+parsed[2]+")"),anim=parsed[1];else if(parsed=attr?attr.match(/^{([\s\S]*)}$/m):null){console.log(parsed[1]);var fun=eval("(function(elem,context,params,callback) {"+parsed[1]+"})");options[key]=new Animation(fun,params);break}options[key]=anim in animations?new Animation(animations[anim],params):new Animation(animations.appear,params),options[key]._elem=$(this),params.start&&(options[key].start=params.start),params.on&&(options[key]._elem=$(params.on));break;case"string":default:options[key]=attr}break;case"function":val=type(attr),"undefined"!=typeof val&&(options[key]=val);break;default:options[key]=attr}options.hasOwnProperty(key)||(options[key]=template[i].default)}return $(this).data("domOptions",options),options},$.fn.present=function(a){return new OliverAndSwan($(this),a)},$.OliverAndSwan=OliverAndSwan,OliverAndSwan.animations=animations}({},function(){return this}());